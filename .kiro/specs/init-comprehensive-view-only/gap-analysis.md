# Gap Analysis: init-comprehensive-view-only

## 分析概要

### スコープ
`/ai-wiki/init`コマンドを「包括的ビュー」のみを扱うように制限する機能実装のギャップ分析。

### 主な課題
- 既存のコマンド定義は`${isComprehensiveView}`変数による条件分岐で包括的ビューと簡潔ビューの両方をサポート
- 簡潔ビューのコードパスとドキュメント記述を削除し、包括的ビューのみに固定する必要がある

### 推奨事項
- **アプローチ**: 既存コマンド定義の修正（Option A: Extend Existing Components）
- **複雑度**: S（1-3日）- 既存パターンに沿った単純な文字列削除と条件分岐の除去
- **リスク**: Low - 既存の包括的ビュー機能は維持され、簡潔ビューのみを削除

## 現在の状態調査

### 主要ファイル/モジュール

**コマンド定義ファイル**:
- `.cursor/commands/ai-wiki/init.md` (256行)
  - 96-168行目: `${isComprehensiveView}`変数による条件分岐
  - 96-143行目: 包括的ビューの生成ロジック
  - 144-168行目: 簡潔ビューの生成ロジック
  - 30-31行目: 出力形式の説明（両方のビューを説明）
  - 226-227行目: Output Description（両方のビューを説明）

### 既存のパターンと規則

**アーキテクチャパターン**:
- Markdownベースのコマンド定義システム
- Cursorエージェントが`<instructions>`セクションを解釈して実行
- 動的変数展開（`${variable}`形式）を使用

**命名規則**:
- コマンドファイル: `kebab-case.md`形式
- 変数: `${variableName}`形式

**統合ポイント**:
- コマンド定義は`.cursor/commands/ai-wiki/init.md`に配置
- 変数展開はエージェントの実行時処理に依存

### 既存の機能

**包括的ビュー機能**（維持対象）:
- セクション階層構造（`sections`配列）
- ページの親子関係（`parent_section`プロパティ）
- 8-12ページの生成
- サブセクション階層のサポート

**簡潔ビュー機能**（削除対象）:
- ページのみの構造（`sections`配列なし）
- `parent_section`プロパティなし
- 4-6ページの生成

## 要件実現可能性分析

### 技術的必要事項

**データモデル/スキーマ**:
- 変更不要 - 既存のJSON構造（包括的ビュー形式）を維持

**API/サービス**:
- 変更不要 - コマンド定義ファイルの修正のみ

**UI/コンポーネント**:
- 変更不要 - コマンド定義の内部ロジックのみ

**ビジネスルール/バリデーション**:
- 簡潔ビューの生成ロジックを削除
- 包括的ビューのみを生成するように固定

**非機能要件**:
- **セキュリティ**: 影響なし
- **パフォーマンス**: 影響なし（条件分岐が削除されるため、わずかに改善の可能性）
- **スケーラビリティ**: 影響なし
- **信頼性**: 影響なし

### ギャップと制約

**不足している機能**:
- なし（既存の包括的ビュー機能を維持）

**削除が必要な機能**:
- 簡潔ビューの生成ロジック（144-168行目）
- 簡潔ビューに関するドキュメント記述（30-31行目、226-227行目）
- `${isComprehensiveView}`変数による条件分岐（96行目、136行目、162行目、181行目）

**調査が必要な領域**:
- なし（既存の包括的ビュー機能は既に実装済みで動作確認済み）

**既存アーキテクチャからの制約**:
- Markdownベースのコマンド定義パターンを維持する必要がある
- 既存の変数展開パターン（`${inputDir}`, `${fileTree}`, `${readme}`）は変更しない

### 複雑度シグナル

- **シンプルなCRUD**: 該当なし
- **アルゴリズムロジック**: 該当なし
- **ワークフロー**: 該当なし
- **外部統合**: 該当なし
- **文字列操作/テンプレート処理**: ✅ 該当（条件分岐の削除と文字列の固定化）

## 実装アプローチの選択肢

### Option A: 既存コンポーネントの拡張（推奨）

**どのファイル/モジュールを拡張するか**:
- `.cursor/commands/ai-wiki/init.md`の以下の箇所を修正:
  - 30-31行目: 出力形式の説明から簡潔ビューの記述を削除
  - 96-168行目: `${isComprehensiveView}`条件分岐を削除し、包括的ビューのコードのみを残す
  - 181行目: 条件分岐を削除し、固定値（8-12ページ）に変更
  - 226-227行目: Output Descriptionから簡潔ビューの記述を削除

**互換性評価**:
- ✅ 既存の包括的ビュー機能は完全に維持される
- ✅ 既存のJSON構造に影響なし
- ✅ 他の変数（`${inputDir}`, `${fileTree}`, `${readme}`）は変更しない
- ✅ 後方互換性: 既存の包括的ビューを使用しているユーザーには影響なし

**複雑度と保守性**:
- ✅ 単純な文字列削除と条件分岐の除去
- ✅ ファイルサイズは削減される（約30行の削除）
- ✅ 単一責任の原則: コマンド定義は包括的ビューのみを扱う

**トレードオフ**:
- ✅ 最小限の変更、高速な初期開発
- ✅ 既存パターンとインフラの活用
- ❌ 簡潔ビュー機能の完全な削除（要件により意図的）

### Option B: 新規コンポーネントの作成

**新規作成の根拠**:
- 該当なし - 既存のコマンド定義を修正するだけで十分

**統合ポイント**:
- 該当なし

**責任境界**:
- 該当なし

**トレードオフ**:
- ❌ 不要な複雑化
- ❌ 既存パターンからの逸脱

### Option C: ハイブリッドアプローチ

**組み合わせ戦略**:
- 該当なし - 単純な修正のみで対応可能

**段階的実装**:
- 該当なし - 単一の修正で完了

**リスク軽減**:
- 該当なし

**トレードオフ**:
- ❌ 不要な複雑化

## 実装複雑度とリスク

### 工数評価: S（1-3日）

**根拠**:
- 既存パターンに沿った単純な文字列削除と条件分岐の除去
- 依存関係なし
- 既存の包括的ビュー機能は維持され、テスト不要

### リスク評価: Low

**根拠**:
- 既存の包括的ビュー機能は維持される
- 既存のJSON構造に影響なし
- 他の変数や機能への影響なし
- 単純な文字列操作のみ

**潜在的なリスク**:
- なし（既存の包括的ビュー機能は既に動作確認済み）

## 設計フェーズへの推奨事項

### 推奨アプローチ

**Option A: 既存コンポーネントの拡張**を推奨します。

**主要な決定事項**:
1. `.cursor/commands/ai-wiki/init.md`の96-168行目の条件分岐を削除
2. 包括的ビューのコード（96-143行目相当）のみを残す
3. 簡潔ビューに関するすべてのドキュメント記述を削除
4. `${isComprehensiveView}`変数の参照をすべて削除

**実装の詳細**:
- 96行目の`${isComprehensiveView ? \``を削除し、直接包括的ビューのコードを記述
- 144行目の` : \``（簡潔ビューの開始）から168行目の`\`}`（条件分岐の終了）までを削除
- 181行目の`${isComprehensiveView ? '8-12' : '4-6'}`を`8-12`に固定
- 181行目の`${isComprehensiveView ? 'comprehensive' : 'concise'}`を`comprehensive`に固定

### 設計フェーズで調査すべき項目

**研究が必要な項目**:
- なし（既存の包括的ビュー機能は既に実装済み）

**確認すべき項目**:
- 既存の包括的ビュー機能が正常に動作していることを確認
- 生成されるJSON構造が既存の仕様と一致していることを確認

## 要件-資産マッピング

### Requirement 1: 包括的ビューの固定化

| 受入基準 | 既存資産 | ギャップ | タグ |
|---------|---------|---------|------|
| 常に包括的ビュー形式のJSON構造を生成 | `.cursor/commands/ai-wiki/init.md` (96-143行目) | 条件分岐の削除が必要 | Constraint |
| `sections`配列を含む | `.cursor/commands/ai-wiki/init.md` (115-122行目) | 既存機能を維持 | Constraint |
| 各ページに`parent_section`プロパティを含む | `.cursor/commands/ai-wiki/init.md` (131行目) | 既存機能を維持 | Constraint |
| 8-12ページを含む | `.cursor/commands/ai-wiki/init.md` (181行目) | 条件分岐を削除し固定値に変更 | Constraint |
| サブセクション階層構造をサポート | `.cursor/commands/ai-wiki/init.md` (120, 138行目) | 既存機能を維持 | Constraint |

### Requirement 2: 簡潔ビュー機能の削除

| 受入基準 | 既存資産 | ギャップ | タグ |
|---------|---------|---------|------|
| `${isComprehensiveView}`変数による条件分岐を含まない | `.cursor/commands/ai-wiki/init.md` (96行目) | 条件分岐の削除が必要 | Missing |
| 簡潔ビュー生成のコードパスを含まない | `.cursor/commands/ai-wiki/init.md` (144-168行目) | 簡潔ビューコードの削除が必要 | Missing |
| 簡潔ビューに関するドキュメント記述を含まない | `.cursor/commands/ai-wiki/init.md` (30-31, 162-167, 227行目) | 簡潔ビュー記述の削除が必要 | Missing |
| 簡潔ビュー形式が要求されても包括的ビューを生成 | `.cursor/commands/ai-wiki/init.md` (144-168行目) | 簡潔ビューコードの削除により自動的に実現 | Missing |

### Requirement 3: コマンド定義の更新

| 受入基準 | 既存資産 | ギャップ | タグ |
|---------|---------|---------|------|
| `${isComprehensiveView}`変数参照を削除 | `.cursor/commands/ai-wiki/init.md` (96, 136, 162, 181行目) | 変数参照の削除が必要 | Missing |
| `<background_information>`から簡潔ビューの説明を削除 | `.cursor/commands/ai-wiki/init.md` (30-31行目) | 簡潔ビュー記述の削除が必要 | Missing |
| `<instructions>`から簡潔ビュー生成ロジックを削除 | `.cursor/commands/ai-wiki/init.md` (144-168行目) | 簡潔ビューコードの削除が必要 | Missing |
| `Output Description`から簡潔ビューの記述を削除 | `.cursor/commands/ai-wiki/init.md` (226-227行目) | 簡潔ビュー記述の削除が必要 | Missing |
| 包括的ビューの生成ロジックのみを含む | `.cursor/commands/ai-wiki/init.md` (96-143行目) | 既存機能を維持 | Constraint |

### Requirement 4: 後方互換性の維持

| 受入基準 | 既存資産 | ギャップ | タグ |
|---------|---------|---------|------|
| 既存の包括的ビュー生成ロジックを維持 | `.cursor/commands/ai-wiki/init.md` (96-143行目) | 既存機能を維持 | Constraint |
| 既存のJSON構造形式を維持 | `.cursor/commands/ai-wiki/init.md` (112-134行目) | 既存機能を維持 | Constraint |
| 既存の変数の使用を維持 | `.cursor/commands/ai-wiki/init.md` (${inputDir}, ${fileTree}, ${readme}) | 既存機能を維持 | Constraint |
| 既存のファイル操作パターンを維持 | `.cursor/commands/ai-wiki/init.md` (49-57, 187-201行目) | 既存機能を維持 | Constraint |

**凡例**:
- **Missing**: 削除が必要な既存機能
- **Constraint**: 既存機能を維持しつつ制約を追加
