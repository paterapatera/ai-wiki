# Implementation Plan: make-wiki-sidebar

## Task Overview

この実装計画は、`/ai-wiki/make`コマンドを拡張し、Wikiページ生成時にサイドバーファイル（`_sidebar.md`）も自動生成する機能を実装します。

- [x] 1. コマンド定義の基本構造を更新する
- [x] 1.1 `<background_information>`セクションにサイドバー生成機能を追加する
  - サイドバー生成の概要を説明
  - サイドバー生成のタイミング（Wikiページ生成の完了後）を説明
  - _Requirements: 5.1, 5.2_

- [x] 1.2 `<Output Description>`セクションにサイドバーファイルの説明を追加する
  - サイドバーファイル（`_sidebar.md`）の出力先と形式を説明
  - サイドバーのMarkdown形式の概要を説明
  - _Requirements: 1.1, 1.2, 1.3, 1.4, 4.1_

- [x] 1.3 `<Safety & Fallback>`セクションにサイドバー生成のエラーハンドリングを追加する
  - サイドバー生成のエラーハンドリングを説明
  - サイドバー生成の失敗がWikiページ生成に影響を与えないことを説明
  - _Requirements: 6.1, 6.2, 6.3_

- [x] 2. サイドバー生成処理を実装する（Step 6）
- [x] 2.1 Step 6: サイドバーファイルの生成セクションを追加する
  - Wikiページ生成の完了後（Step 5の後）に実行
  - 既存の変数（`${wikiStructure}`, `${sections}`, `${pages}`, `${outputDir}`）を再利用
  - _Requirements: 5.1, 5.2, 5.3_

- [x] 2.2 セクション構造の判定処理を実装する
  - `${sections}`配列が存在するかどうかを確認
  - 存在する場合: セクション構造に基づくナビゲーションを生成
  - 存在しない場合（簡潔ビュー）: 全ページをフラットなリストとして生成
  - _Requirements: 2.1, 2.6_

- [x] 2.3 セクション構造に基づくナビゲーション生成処理を実装する
  - `${sections}`配列をループ処理して、各セクションごとに処理
  - 各セクションの`title`をセクション見出しとして使用（`## Section Title`形式）
  - 各セクションの`pages`配列に含まれるページIDを参照
  - セクションの順序を`sections`配列の順序に従う
  - _Requirements: 2.1, 2.2, 2.5_

- [x] 2.4 ページリンクの生成処理を実装する
  - 各ページの`id`を基にファイルパスを生成（形式：`{page-id}`、`.md`拡張子は含めない）
  - 各ページの`title`をリンクテキストとして使用
  - ページタイトルが存在しない場合は、ページIDをフォールバックとして使用
  - Markdownリンク構文（`[Page Title](page-id)`）で生成
  - ページの順序を、各セクションの`pages`配列の順序に従う
  - _Requirements: 3.1, 3.2, 3.3, 3.4, 3.5_

- [x] 2.5 サイドバーのMarkdown形式生成処理を実装する
  - セクション見出し: `## Section Title`（H2見出し）
  - トップレベルのページリンク: `- [Page Title](page-id)`（`.md`拡張子は含めない）
  - サブレベルのページリンク: `  - [Page Title](page-id)`（2スペースのインデント）
  - セクション間の空行を挿入（可読性向上）
  - サイドバーの内容を日本語で生成
  - _Requirements: 4.1, 4.2, 4.3, 4.4, 4.5, 7.2, 7.3, 7.4_

- [x] 2.6 簡潔ビュー（sections配列が存在しない場合）の処理を実装する
  - 全ページをフラットなリストとして生成
  - セクション見出しなしで、ページリンクのみを生成
  - ページの順序は`pages`配列の順序に従う
  - _Requirements: 2.6_

- [x] 2.7 サイドバーファイルの書き込み処理を実装する
  - `write`ツールを使用して、生成されたMarkdownコンテンツを`${outputDir}/_sidebar.md`に書き込み
  - ファイル名は`_sidebar.md`とする
  - ファイルパスは`${outputDir}/_sidebar.md`形式
  - _Requirements: 1.1, 1.2, 1.3, 1.4_

- [x] 3. エラーハンドリング処理を実装する
- [x] 3.1 サイドバー生成のエラーハンドリングを実装する
  - セクション構造の解析エラー: エラーメッセージを報告し、サイドバー生成をスキップ（Wikiページ生成は継続）
  - ファイル書き込み失敗: エラーメッセージを報告し、サイドバー生成をスキップ（Wikiページ生成は継続）
  - エラーメッセージは日本語で明確に報告
  - サイドバー生成の失敗がWikiページ生成に影響を与えないことを保証
  - _Requirements: 6.1, 6.2, 6.3_

- [x] 3.2 ページタイトルが存在しない場合のフォールバック処理を実装する
  - ページタイトルが存在しない場合は、ページIDをリンクテキストとして使用
  - エラーとして扱わず、正常な処理として継続
  - _Requirements: 3.5_

- [x] 4. 完了報告の更新を実装する
- [x] 4.1 完了報告にサイドバー生成の成功/失敗を含める
  - サイドバー生成の成功/失敗を完了報告に含める
  - 生成されたサイドバーファイルのパス（`${outputDir}/_sidebar.md`）をユーザーに報告
  - Wikiページ生成の完了報告は既存のまま維持
  - _Requirements: 6.4, 6.5_

- [ ] 5. 将来の拡張への対応（オプション）
- [ ] 5.1 サブセクション（subsections配列）の階層構造対応を準備する（将来の拡張）
  - 現在は実装しないが、将来の拡張として考慮
  - `subsections`配列が存在する場合の階層構造の表現方法を検討可能な構造にする
  - _Requirements: 2.4_

- [ ] 5.2 サイドバーの先頭にWikiタイトルを含める機能を準備する（将来の拡張）
  - 現在は実装しないが、将来の拡張として考慮
  - `${wikiStructure.title}`を使用してWikiタイトルを取得可能な構造にする
  - _Requirements: 7.1_

